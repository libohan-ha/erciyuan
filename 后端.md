**1. 依赖安装 (`backend/package.json`)**

{
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5-lts.1",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1"
  }
}

2.**核心逻辑 (`backend/app.js`)**

- 连接 MongoDB 数据库。
- 引入并使用 `cors` 中间件，允许前端跨域请求。
- 引入 `express.json()` 中间件，解析请求体。
- 配置 `multer`，设置文件存储路径为 `uploads/`，并自定义文件名（如加时间戳防重复）。
- **配置静态文件服务**：`app.use('/uploads', express.static('uploads'));` 这样前端才能通过 `/uploads/xxx.jpg` 访问图片。
- 挂载路由：`app.use('/api/auth', authRoutes)` 等。
- 启动服务器监听端口。

**3. 数据模型 (`backend/models/`)**

使用 Mongoose 定义 Schema，与我们之前讨论的数据库结构完全对应。

**4. JWT 认证中间件 (`backend/middleware/auth.js`)**

- 从请求头的 `Authorization` 字段获取 Token (`Bearer <token>`)。
- 验证 Token 的有效性（是否过期、是否被篡改）。
- 如果有效，将解码出的用户信息（如 `userId`）附加到 `req` 对象上，然后调用 `next()`。
- 如果无效或不存在，返回 `401 Unauthorized` 错误。

**5. 路由实现 (`backend/routes/`)**

- **`auth.js`**:
  - `POST /register`: 接收用户名和密码，用 `bcryptjs` 加密密码后存入数据库。
  - `POST /login`: 验证用户名密码，成功则用 `jsonwebtoken` 签发一个 Token 返回给前端。
- **`users.js`**:
  - `GET /me`: 使用 `auth` 中间件保护，返回当前登录用户的信息。
  - `PUT /me`: 使用 `auth` 中间件，更新用户信息（如密码）。
- **`images.js`**:
  - `GET /`: 使用 `auth` 中间件，查询 `images` 集合，`ownerId` 等于当前用户ID。支持 `query` 参数进行分页、搜索、标签筛选。
  - `POST /`: 使用 `auth` 中间件和 `multer` 中间件，处理文件上传，并将图片信息（包括URL、标题、标签等）存入数据库。
  - `GET /:id`: 获取单张图片详情。
  - `PUT /:id`: 使用 `auth` 中间件，更新图片信息。
  - `DELETE /:id`: 使用 `auth` 中间件，删除图片记录，并**同时删除 `uploads/` 目录下的对应文件**。
- **`albums.js`**:
  - 所有接口都使用 `auth` 中间件保护。
  - 实现相册的增删改查逻辑。注意，删除相册时，只删除相册本身，不删除图片，但可以将图片的 `albumId` 字段置空。